<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Document</title>
  </head>
  <body>
    <form action="/register" id="registerForm" method="post">
      请输入用户名：<input type="text" name="userName" />
      <br />
      请输入密码：<input type="text" name="password" />
      <br />
      请输入手机号码：<input type="text" name="phoneNumber" />
      <br />
      <button>提交</button>
    </form>

    <script>
      const strategies = {
        isNonEmpty(value, errorMsg) {
          // 不为空
          if (value === '') {
            return errorMsg
          }
        },
        minLength(value, length, errorMsg) {
          // 限制最小长度
          if (value.length < length) {
            return errorMsg
          }
        },
        isMobile(value, errorMsg) {
          // 手机号码格式
          if (!/(^1[3|5|8][0-9]{9}$)/.test(value)) {
            return errorMsg
          }
        },
      }

      class Validator {
        constructor() {
          this.cache = []
        }
        add(dom, rule, errorMsg) {
          // example: minLength:6
          const ary = rule.split(':') // ['minLength', '6']
          this.cache.push(() => {
            const strategy = ary.shift() // strategy->minLength ary->['6']
            ary.unshift(dom.value) // [value,'6']
            ary.push(errorMsg) // [value, '6', errorMsg]
            return strategies[strategy].apply(dom, ary)
          })
        }
        start() {
          let validatorFunc
          for (let i = 0; (validatorFunc = this.cache[i++]); ) {
            const msg = validatorFunc()
            if (msg) {
              return msg
            }
          }
        }
      }

      const validateFunc = () => {
        const validator = new Validator()

        validator.add(
          registerForm.userName,
          'isNonEmpty',
          'User name cannot be empty'
        )

        validator.add(
          registerForm.password,
          'minLength:6',
          'Password length cannot be less than 6 bits'
        )

        validator.add(
          registerForm.phoneNumber,
          'isMobile',
          'The mobile number is not in the correct format'
        )

        const errorMsg = validator.start()
        return errorMsg
      }
      // test
      const registerForm = document.getElementById('registerForm')
      registerForm.addEventListener('submit', (e) => {
        e.preventDefault()
        // debugger
        const errorMsg = validateFunc()
        if (errorMsg) {
          alert(errorMsg)
          return false
        }
      })
    </script>
  </body>
</html>
